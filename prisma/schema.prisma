generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String        @id @default(cuid())
  email       String        @unique
  name        String?
  password    String
  role        Role          @default(MEMBER)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  disposisi   Disposisi[]
  suratKeluar SuratKeluar[]
  suratMasuk  SuratMasuk[]
  SuratTamu   SuratTamu[]

  @@map("users")
}

model SuratMasuk {
  id                String        @id @default(cuid())
  noUrut            Int           @unique
  nomorSurat        String?       @unique
  tanggalSurat      DateTime
  tanggalDiteruskan DateTime
  asalSurat         String
  perihal           String
  keterangan        String?
  filePath          String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  createdById       String
  disposisi         Disposisi[]
  suratKeluar       SuratKeluar[]
  createdBy         User          @relation(fields: [createdById], references: [id])

  @@map("surat_masuk")
}

model Disposisi {
  id               String          @id @default(cuid())
  nomorDisposisi   String?         @unique
  noUrut           Int
  tanggalDisposisi DateTime
  tujuanDisposisi  String
  isiDisposisi     String
  keterangan       String?
  status           StatusDisposisi @default(SELESAI)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  suratMasukId     String
  createdById      String
  createdBy        User            @relation(fields: [createdById], references: [id])
  suratMasuk       SuratMasuk      @relation(fields: [suratMasukId], references: [id], onDelete: Cascade)

  @@map("disposisi")
}

model SuratKeluar {
  id           String        @id @default(cuid())
  noUrut       Int           @unique
  klas         String
  pengolah     PengolahSurat
  tanggalSurat DateTime
  perihalSurat String
  kirimKepada  String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  suratMasukId String?
  createdById  String
  createdBy    User          @relation(fields: [createdById], references: [id])
  suratMasuk   SuratMasuk?   @relation(fields: [suratMasukId], references: [id])

  @@map("surat_keluar")
}

enum Role {
  ADMIN
  MEMBER
}

enum StatusDisposisi {
  SELESAI
}

enum PengolahSurat {
  KETUA_DPRD
  WAKIL_KETUA_1
  WAKIL_KETUA_2
  WAKIL_KETUA_3
  SEKWAN
}

// Model for guest visits / surat tamu
model SuratTamu {
  id          String   @id @default(cuid())
  noUrut      Int      @unique
  nama        String
  keperluan   String
  asalSurat   String
  tujuanSurat String
  nomorTelpon String?
  tanggal     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@map("surat_tamu")
}

// Audit Log untuk tracking security events dan perubahan data
model AuditLog {
  id          String   @id @default(cuid())
  userId      String?  // null jika failed login (user belum teridentifikasi)
  action      String   // LOGIN, LOGOUT, CREATE, UPDATE, DELETE, FAILED_LOGIN
  entity      String?  // User, SuratMasuk, Disposisi, dll
  entityId    String?  // ID dari entity yang diubah
  ipAddress   String?
  userAgent   String?
  details     String?  // JSON string untuk detail tambahan
  success     Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_logs")
}
